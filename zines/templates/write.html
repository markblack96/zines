<head>
<!-- link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="{{ url_for('static', filename='write.css') }}"rel="stylesheet">
</head>
<body>

<!-- button id="submit" type="submit">
    Submit
</button -->
<div id="editor">
</div>
</div>
    <script>
        const editor = document.querySelector('#editor')
        const writer = document.createElement('div');
        writer.id = 'writer';
        editor.appendChild(writer);
        const textContainer = document.createElement('textarea');
        writer.appendChild(textContainer);

        const preview = document.createElement('div');
        preview.id = 'post';
        writer.appendChild(preview);
        textContainer.onkeypress = (e)=>{
            if (e.key !== "Enter") {
                console.log(marked(e.target.value + e.key));
                preview.innerHTML=marked(e.target.value + e.key);
            }
        }
        const submit = document.createElement('button');
        submit.innerText = 'Submit';
        submit.onclick = ()=>{
            fetch('/write', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({content: textContainer.value})})
                .then(response=>response.json())
                .then(d=>console.log(d));
        }
        editor.appendChild(submit);

        let path = window.location.pathname.split('/');
        if (path[path.length-1] !== "write") {
            let post_id = path[path.length-1]; // assume it's a post id
            let md = fetch('/md/'+post_id)
                .then(response => response.json())
                .then(json=>textContainer.value=d.md);
        }
    </script>
</body>
